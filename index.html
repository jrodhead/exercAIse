<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>exercAIse — Latest Workout</title>
    <link rel="stylesheet" href="assets/styles.css" />
    <link rel="manifest" href="manifest.webmanifest" />
    <meta name="theme-color" content="#111111" />
  </head>
  <body>
    <header class="site-header">
      <h1>exercAIse</h1>
      <nav>
        <a href="#" id="nav-home">Home</a>
        <a href="#" id="nav-workouts">Workouts</a>
        <a href="#" id="nav-history">History</a>
        <a href="rpe-guide.html">RPE Guide</a>
        <a href="https://github.com/jrodhead/exercAIse#readme" target="_blank" rel="noopener">README</a>
      </nav>
    </header>

    <main class="container">
      <section id="generate-section" class="readme">
        <h2>Session Plan (JSON)</h2>
        <p class="form-hint">Paste a SessionPlan JSON to preview and log.</p>
        <form id="generate-form" class="responsive-form">
          <div class="form-grid">
            <div>
              <label for="gen-goals">Goals</label>
              <textarea id="gen-goals" rows="3" placeholder="e.g., 30–40 min full-body strength, knee-friendly"></textarea>
            </div>
            <div>
              <label for="gen-pain">Pain/Injury</label>
              <input id="gen-pain" type="text" placeholder="e.g., knees, lower back" />
            </div>
            <div>
              <label for="gen-equipment">Equipment</label>
              <input id="gen-equipment" type="text" placeholder="e.g., dumbbells, bands, bench" />
            </div>
            <div class="form-full-width">
              <label for="gen-instructions">Personal instructions (optional, not stored)</label>
              <textarea id="gen-instructions" rows="3" placeholder="Any preferences, constraints, or schedule details"></textarea>
            </div>
          </div>
          <div class="form-actions flex flex-wrap gap-3">
            <button id="gen-submit" type="button">Generate with Kai</button>
            <button id="gen-clear" type="button" class="secondary">Clear</button>
          </div>
          <p class="form-hint">Expected keys: version, title, exercises[]. Each exercise: name, prescribed{ sets, reps or "x-y", rpe?, weight? }. Slugs are optional; unknown/missing slugs will render as non-links with a warning.</p>
          <div class="form-full-width">
            <textarea id="gen-json" rows="8" placeholder='{"version":"1.0","title":"My Session","exercises":[{"slug":"goblet_squat","name":"Goblet Squat","prescribed":{"sets":3,"reps":"8-12","rpe":7}}]}'></textarea>
          </div>
          <div class="form-actions flex flex-wrap gap-3">
            <button id="gen-load-json" type="button" class="secondary">Load JSON</button>
          </div>
        </form>
      </section>
  <section id="status" class="status"></section>

  <section id="readme-section" class="readme">
        <h2>Workout Index</h2>
  <p class="form-hint">Tap a workout title to open the session and logger.</p>
        <article id="readme-content" class="workout-content" aria-live="polite"></article>
      </section>

      <section id="logs-section" class="readme" style="display:none;">
        <h2>History</h2>
        <p class="form-hint">Latest performed logs (from the GitHub repo).</p>
        <div id="logs-list"></div>
      </section>

      <hr />

      <section class="workout-meta" id="workout-meta" style="display:none;">
        <div>
          <strong>Session:</strong>
          <span id="workout-title"></span>
        </div>
        <div class="meta-actions">
          <a id="back-to-index" href="index.html" class="secondary">Back to Index</a>
          <button id="reload-btn" type="button">Reload</button>
          <a id="open-on-github" href="#" target="_blank" rel="noopener">Open file</a>
        </div>
      </section>

      <section class="workout" id="workout-section" style="display:none;">
        <article id="workout-content" class="workout-content" aria-live="polite"></article>
      </section>

      <section class="form" id="form-section" style="display:none;">
        <h2>Log Performed Values</h2>
        <p class="form-hint">Add sets for each exercise you performed. Your entries stay on this device (localStorage). You can also copy JSON for backup.</p>

        <form id="performance-form">
          <div id="exercise-forms"></div>

          <div class="form-actions">
            <button id="save-local" type="button">Save locally</button>
            <button id="copy-json" type="button">Copy JSON</button>
            <button id="download-json" type="button">Download JSON</button>
            <button id="submit-issue" type="button" class="secondary">Submit via GitHub Issue</button>
            <a id="open-issue" class="secondary" href="https://github.com/jrodhead/exercAIse/issues/new" target="_blank" rel="noopener" style="display:none;">Open Issue</a>
            <button id="clear-form" type="button" class="danger">Clear</button>
          </div>
        </form>

        <div id="copy-target-wrapper" class="copy-wrapper" style="display:none;">
          <label for="copy-target">Copied JSON (manual copy if needed):</label>
          <textarea id="copy-target" rows="8" readonly></textarea>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <small>© <span id="year"></span> exercAIse. Works offline for logged data via localStorage.</small>
    </footer>

    <!-- Load session parser module first -->
    <script src="assets/session-parser.js"></script>
    <script src="assets/kai-integration.js"></script>
    <script src="assets/form-builder.js"></script>
    <script src="assets/app.js"></script>
    <script>
      // Register service worker (graceful failure on old browsers)
      (function(){
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('./sw.js').catch(function(){});
        }
      })();
    </script>
  </body>
  </html>
