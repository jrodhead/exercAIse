<!DOCTYPE html>
<html>
<head>
    <title>exercAIse Workouts</title>
</head>
<body>
    <ul id="workout-list"></ul>

    <script>
        function loadFile(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        callback(null, xhr.responseText);
                    } else {
                        callback('Error loading workouts', null);
                    }
                }
            };
            xhr.open('GET', url, true);
            xhr.send();
        }
        
        function parseWorkoutTitle(filename) {
            var name = filename.replace('workouts/', '').replace('.json', '');
            var parts = name.split('_');
            var blockWeek = parts[0];
            var title = parts.slice(1).join(' ').replace(/_/g, ' ');
            var blockWeekParts = blockWeek.split('-');
            var block = blockWeekParts[0];
            var week = blockWeekParts[1];
            
            return {
                block: block,
                week: week,
                title: title,
                filename: filename
            };
        }
        
        window.onload = function() {
            loadFile('workouts/manifest.txt', function(err, data) {
                if (err) {
                    document.getElementById('workout-list').innerHTML = '<li>Error loading workouts</li>';
                    return;
                }
                
                var lines = data.split('\n').filter(function(line) { 
                    return line.trim() && line.indexOf('.json') > -1; 
                });
                
                var workouts = [];
                for (var i = 0; i < lines.length; i++) {
                    var workout = parseWorkoutTitle(lines[i].trim());
                    workouts.push(workout);
                }
                
                workouts.sort(function(a, b) {
                    if (a.block !== b.block) return parseInt(b.block) - parseInt(a.block);
                    return parseInt(b.week) - parseInt(a.week);
                });
                
                var html = '';
                for (var i = 0; i < workouts.length; i++) {
                    var w = workouts[i];
                    html += '<li><a href="' + w.filename + '">';
                    html += 'Block ' + w.block + ', Week ' + w.week + ': ' + w.title;
                    html += '</a></li>';
                }
                
                document.getElementById('workout-list').innerHTML = html;
            });
        };
    </script>
</body>
</html>